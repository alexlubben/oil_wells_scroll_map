<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Louisiana Land Loss: A Scroll Story</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Georgia:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: Georgia, 'Times New Roman', serif;
      overflow-x: hidden;
      background: white;
    }

    #map {
      position: fixed;
      inset: 0;
      z-index: 0;
      background: none;
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
      image-rendering: pixelated;
    }

    #scrolly {
      position: relative;
      z-index: 1;
      width: 100%;
    }

    .step {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .step-content {
      max-width: 400px;
      padding: 1.5rem 2rem;
      font-size: 1.1rem;
      line-height: 1.6;
      background: #333333;
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .step-content:hover {
      background: #333333;
      transform: translateY(-2px);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .step.is-active .step-content {
      background: #333333;
    }

  .highlight {
    color: #86bbf1;
  }

  .highlight-red {
    color: #f44d38;
  }

    @media (max-width: 600px) {
      .step-content {
        max-width: 90%;
        padding: 1rem;
        font-size: 1rem;
      }
    }

    .spacer {
      height: 50vh;
    }

    /* Smoother tile rendering */
    .leaflet-tile {
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
      image-rendering: pixelated;
      transition: opacity 0.5s ease;
    }

    .leaflet-fade-anim .leaflet-tile {
      transition: opacity 0.5s ease;
    }
  </style>
</head>
<body>

  <div id="map"></div>

  <section id="scrolly">
    <div class="spacer"></div>

    <div class="step" data-step="1">
      <div class="step-content">
        <p>In 1932, Louisiana's coastal wetlands extended far into <span class="highlight">what is now open water</span>. Extensive marshlands protected inland communities.</p>
      </div>
    </div>

    <div class="step" data-step="2">
      <div class="step-content">
        <p>Land that existed in 1932 is represented in <span class="highlight">blue</span>.</p>
      </div>
    </div>

    <div class="step" data-step="3">
      <div class="step-content">
        <p>Human activities began reshaping the coast. Oil extraction disrupted the ecosystem. Levees starved wetlands of sediment.</p>
      </div>
    </div>

    <div class="step" data-step="4">
      <div class="step-content">
        <p>The effects of <span class="highlight">climate change</span> are compounding existing problems.</p>
      </div>
    </div>

    <div class="step" data-step="5">
      <div class="step-content">
        <p>Oil wells once on solid ground now sit in open water. Louisiana has lost over <span class="highlight">1,900 square miles of land</span> since the 1930s.</p>
      </div>
    </div>

    <div class="step" data-step="6">
      <div class="step-content">
        <p>A new analysis from The Times-Picayune has found more than 8,000 wells that were drilled on land that are now <span class="highlight">below the water's surface</span>.</p>
      </div>
    </div>

    <div class="step" data-step="7">
      <div class="step-content">
        <p>The <span class="highlight-red">red areas</span> represent areas where oil wells have become submerged.</p>
      </div>
    </div>

    <div class="step" data-step="8">
      <div class="step-content">
        <p>As sea levels rise, thousands of wells will <span class="highlight">fall below the waterline</span>.</p>
      </div>
    </div>

    <div class="spacer"></div>
  </section>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/scrollama"></script>
  <script>
    const tileBounds = L.latLngBounds([28.8, -90.3], [29.7, -88.5]);

    // Function to get appropriate zoom and center based on screen size
    function getMapSettings() {
      const isMobile = window.innerWidth <= 768;
      const isSmallMobile = window.innerWidth <= 480;
      
      if (isSmallMobile) {
        return {
          center: [29.1, -89.6],
          zoom: 12, // Increased for higher resolution
          padding: [2, 2]
        };
      } else if (isMobile) {
        return {
          center: [29.15, -89.3],
          zoom: 11.5, // Increased for higher resolution
          padding: [2, 2]
        };
      } else {
        return {
          center: [29.25, -88.8],
          zoom: 9, // Increased for higher resolution
          padding: [0, 0]
        };
      }
    }

    const mapSettings = getMapSettings();

    const map = L.map('map', {
      center: mapSettings.center,
      zoom: mapSettings.zoom,
      zoomControl: false,
      dragging: false,
      scrollWheelZoom: false,
      doubleClickZoom: false,
      boxZoom: false,
      touchZoom: false,
      keyboard: false,
      attributionControl: false,
      maxBounds: tileBounds,
      maxBoundsViscosity: 1.0,
      fadeAnimation: true,
      zoomAnimation: true,
      markerZoomAnimation: true
    });

    const layer2020 = L.tileLayer('tiles/2020/{z}/{x}/{y}.png', {
      minZoom: 6,
      maxZoom: 14, // Increased for higher resolution
      bounds: tileBounds,
      errorTileUrl: '',
    }).addTo(map);

    const layer1932 = L.tileLayer('tiles/1932/{z}/{x}/{y}.png', {
      opacity: 1,
      minZoom: 6,
      maxZoom: 14, // Increased for higher resolution
      bounds: tileBounds,
      errorTileUrl: '',
    }).addTo(map);

    map.fitBounds(tileBounds, { padding: mapSettings.padding });

    const scroller = scrollama();

    function handleStepEnter(response) {
      document.querySelectorAll('.step').forEach(s => s.classList.remove('is-active'));
      response.element.classList.add('is-active');
    }

    function handleStepExit(response) {
      response.element.classList.remove('is-active');
    }

    function handleStepProgress(response) {
      const step = parseInt(response.element.dataset.step);
      const progress = response.progress;
      const totalSteps = 8; // Updated to match actual number of steps
      const overallProgress = (step - 1 + progress) / totalSteps;
      
      // Smoother easing function for opacity transition
      const easedProgress = 1 - Math.pow(overallProgress, 0.8);
      const opacity = Math.max(0, Math.min(1, easedProgress));
      
      layer1932.setOpacity(opacity);
    }

    scroller
      .setup({
        step: '.step',
        offset: 0.5,
        progress: true,
        debug: false
      })
      .onStepEnter(handleStepEnter)
      .onStepExit(handleStepExit)
      .onStepProgress(handleStepProgress);

    window.addEventListener('resize', function () {
      scroller.resize();

      // Update map settings on resize
      const newSettings = getMapSettings();
      map.setView(newSettings.center, newSettings.zoom);
      map.fitBounds(tileBounds, { padding: newSettings.padding });
    });

  </script>
</body>
</html>