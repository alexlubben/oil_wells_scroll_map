<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Louisiana Land Loss: A Scroll Story</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <style>
    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      font-family: system-ui, sans-serif;
      overflow-x: hidden;
    }

    #map {
      position: fixed;
      inset: 0;
      z-index: 0;
    }

    #scrolly {
      position: relative;
      z-index: 1;
    }

    .step {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .step-content {
      max-width: 400px;
      padding: 1.5rem 2rem;
      font-size: 1.1rem;
      line-height: 1.6;
      background: rgba(0, 0, 0, 0.9);
      color: #fff;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }

    .step-content:hover {
      background: rgba(0, 0, 0, 0.95);
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .step-content h3 {
      margin: 0 0 1rem 0;
      color: #fff;
      font-size: 1.4rem;
      font-weight: 600;
    }

    .step-content p {
      margin: 0;
      color: #fff;
    }

    /* Active step styling */
    .step.is-active .step-content {
      background: rgba(0, 0, 0, 1);
      border-left: 4px solid #67000d;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
    }

    /* Spacer for smooth scrolling */
    .spacer {
      height: 50vh;
    }
  </style>
</head>
<body>

<div id="map"></div>

<section id="scrolly">
  <div class="spacer"></div>
  
  <div class="step" data-step="1">
    <div class="step-content">
      <p>In 1932, Louisiana's coastal wetlands extended far into what is now open water. Extensive marshlands protected inland communities.</p>
    </div>
  </div>
  
  <div class="step" data-step="2">
    <div class="step-content">
      <p>Human activities and natural processes began reshaping the coast. River channelization and oil extraction disrupted the ecosystem.</p>
    </div>
  </div>
  
  <div class="step" data-step="3">
    <div class="step-content">
      <p>Climate change effects compounded existing problems. Major hurricanes dramatically reshaped the coastline in just days.</p>
    </div>
  </div>
  
  <div class="step" data-step="4">
    <div class="step-content">
      <p>Oil wells once on solid ground now sit in open water. Louisiana has lost over 1,900 square miles since the 1930s.</p>
    </div>
  </div>

  <div class="step" data-step="5">
    <div class="step-content">
      <p>A new analysis from The Times-Picayune has found thousands of wells that were drilled on land that are now below the water's surface.</p>
    </div>
  </div>

  <div class="step" data-step="6">
    <div class="step-content">
      <p>As sea levels rise, thousands more will become submerged.</p>
    </div>
  </div>
  
  <div class="spacer"></div>
</section>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/scrollama"></script>
<script>
// Initialize the map
const map = L.map('map', {
  center: [29.2, -89.4],
  zoom: 9, // Try zoom 9 instead of 10
  zoomControl: false,
  dragging: false,
  scrollWheelZoom: false,
  doubleClickZoom: false,
  boxZoom: false,
  touchZoom: false,
  keyboard: false
});

// Create the 2020 layer (base layer) - match your exported zoom levels
const layer2020 = L.tileLayer('tiles/2020/{z}/{x}/{y}.png', {
  minZoom: 6,
  maxZoom: 12,
  errorTileUrl: ''
}).addTo(map);

// Create the 1932 layer (overlay layer that will fade) - match your exported zoom levels
const layer1932 = L.tileLayer('tiles/1932/{z}/{x}/{y}.png', {
  opacity: 1,
  minZoom: 6,
  maxZoom: 12,
  errorTileUrl: ''
}).addTo(map);

// Add error handling to see if tiles are loading
layer2020.on('tileerror', function(e) {
  console.log('2020 tile error:', e.tile.src);
});

layer1932.on('tileerror', function(e) {
  console.log('1932 tile error:', e.tile.src);
});

// Try to fit the map to the area where you have tiles
// Adjust these coordinates based on your actual tile coverage
const tileBounds = L.latLngBounds(
  [28.8, -90.2], // Southwest - adjust based on your data
  [29.6, -88.6]  // Northeast - adjust based on your data
);

// Fit the map to show the tile area
map.fitBounds(tileBounds, {
  padding: [20, 20] // Add some padding
});

// Initialize scrollama
const scroller = scrollama();

// Handle step enter
function handleStepEnter(response) {
  const step = parseInt(response.element.dataset.step);
  console.log('Step entered:', step);
  
  // Remove active class from all steps
  document.querySelectorAll('.step').forEach(s => s.classList.remove('is-active'));
  
  // Add active class to current step
  response.element.classList.add('is-active');
}

// Handle step exit
function handleStepExit(response) {
  response.element.classList.remove('is-active');
}

// Handle progress for smooth transitions
function handleStepProgress(response) {
  const step = parseInt(response.element.dataset.step);
  const progress = response.progress;
  
  // Calculate smooth opacity based on overall scroll progress
  // We have 6 steps, so each step represents 1/6 of the total fade
  const totalSteps = 6;
  const overallProgress = (step - 1 + progress) / totalSteps;
  
  // Smooth opacity transition from 1 to 0
  const opacity = Math.max(0, Math.min(1, 1 - overallProgress));
  
  console.log(`Step ${step}, Progress: ${progress.toFixed(2)}, Overall: ${overallProgress.toFixed(2)}, Opacity: ${opacity.toFixed(2)}`);
  layer1932.setOpacity(opacity);
}

// Setup scrollama
scroller
  .setup({
    step: '.step',
    offset: 0.5, // Trigger when step is 50% visible
    progress: true, // Enable progress tracking for smooth transitions
    debug: false // Set to true for debugging
  })
  .onStepEnter(handleStepEnter)
  .onStepExit(handleStepExit)
  .onStepProgress(handleStepProgress); // Add progress handler

// Handle resize
window.addEventListener('resize', scroller.resize);

console.log('Scrollama initialized');
</script>
</body>
</html>